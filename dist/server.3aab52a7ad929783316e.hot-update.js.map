{"version":3,"sources":["webpack:///./src/SignInNavItem.jsx"],"names":["SigninNavItem","React","Component","constructor","props","state","showing","disabled","showModal","bind","hideModal","signOut","signIn","componentDidMount","clientId","window","ENV","GOOGLE_CLIENT_ID","gapi","load","auth2","getAuthInstance","init","client_id","then","setState","showError","googleToken","googleUser","getAuthResponse","id_token","error","apiEndpoint","UI_AUTH_ENDPOINT","response","fetch","method","credentials","headers","body","JSON","stringify","google_token","text","result","parse","signedIn","givenName","onUserChange","render","user","withToast"],"mappings":"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","file":"server.3aab52a7ad929783316e.hot-update.js","sourcesContent":["import React from 'react';\r\nimport {\r\n  NavItem, Modal, Button, NavDropdown, MenuItem,\r\n} from 'react-bootstrap';\r\n\r\nimport withToast from './withToast.jsx';\r\n\r\nclass SigninNavItem extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      showing: false,\r\n      disabled: true,\r\n    };\r\n    this.showModal = this.showModal.bind(this);\r\n    this.hideModal = this.hideModal.bind(this);\r\n    this.signOut = this.signOut.bind(this);\r\n    this.signIn = this.signIn.bind(this);\r\n  }\r\n\r\n  componentDidMount() {\r\n    const clientId = window.ENV.GOOGLE_CLIENT_ID;\r\n    if (!clientId) return;\r\n    window.gapi.load('auth2', () => {\r\n      if (!window.gapi.auth2.getAuthInstance()) {\r\n        window.gapi.auth2.init({ client_id: clientId }).then(() => {\r\n          this.setState({ disabled: false });\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  async signIn() {\r\n    this.hideModal();\r\n    const { showError } = this.props;\r\n    let googleToken;\r\n    try {\r\n      const auth2 = window.gapi.auth2.getAuthInstance();\r\n      const googleUser = await auth2.signIn();\r\n      googleToken = googleUser.getAuthResponse().id_token;\r\n    } catch (error) {\r\n      showError(`Error authenticating with Google: ${error.error}`);\r\n    }\r\n\r\n    try {\r\n      const apiEndpoint = window.ENV.UI_AUTH_ENDPOINT;\r\n      const response = await fetch(`${apiEndpoint}/signin`, {\r\n        method: 'POST',\r\n        credentials: 'include',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ google_token: googleToken }),\r\n      });\r\n      const body = await response.text();\r\n      const result = JSON.parse(body);\r\n      const { signedIn, givenName } = result;\r\n\r\n      const { onUserChange } = this.props;\r\n      onUserChange({ signedIn, givenName });\r\n    } catch (error) {\r\n      showError(`Error signing into the app: ${error}`);\r\n    }\r\n  }\r\n\r\n  async signOut() {\r\n    const apiEndpoint = window.ENV.UI_AUTH_ENDPOINT;\r\n    const { showError } = this.props;\r\n    try {\r\n      await fetch(`${apiEndpoint}/signout`, {\r\n        method: 'POST',\r\n        credentials: 'include',\r\n      });\r\n      const auth2 = window.gapi.auth2.getAuthInstance();\r\n      await auth2.signOut();\r\n      const { onUserChange } = this.props;\r\n      onUserChange({ signedIn: false, givenName: '' });\r\n    } catch (error) {\r\n      showError(`Error signing out: ${error}`);\r\n    }\r\n  }\r\n\r\n  showModal() {\r\n    const clientId = window.ENV.GOOGLE_CLIENT_ID;\r\n    const { showError } = this.props;\r\n    if (!clientId) {\r\n      showError('Missing environment variable GOOGLE_CLIENT_ID');\r\n      return;\r\n    }\r\n    this.setState({ showing: true });\r\n  }\r\n\r\n  hideModal() {\r\n    this.setState({ showing: false });\r\n  }\r\n\r\n  render() {\r\n    const { user } = this.props;\r\n    if (user.signedIn) {\r\n      return (\r\n        <NavDropdown title={user.givenName} id=\"user\">\r\n          <MenuItem onClick={this.signOut}>Sign out</MenuItem>\r\n        </NavDropdown>\r\n      );\r\n    }\r\n\r\n    const { showing, disabled } = this.state;\r\n    return (\r\n      <>\r\n        <NavItem onClick={this.showModal}>\r\n          Sign in\r\n        </NavItem>\r\n        <Modal keyboard show={showing} onHide={this.hideModal} bsSize=\"sm\">\r\n          <Modal.Header closeButton>\r\n            <Modal.Title>Sign in</Modal.Title>\r\n          </Modal.Header>\r\n          <Modal.Body>\r\n            <Button\r\n              block\r\n              disabled={disabled}\r\n              bsStyle=\"primary\"\r\n              onClick={this.signIn}\r\n            >\r\n              <img src=\"https://developers.google.com/identity/images/btn_google_signin_light_normal_web.png\" alt=\"Sign In\" />\r\n            </Button>\r\n          </Modal.Body>\r\n          <Modal.Footer>\r\n            <Button bsStyle=\"link\" onClick={this.hideModal}>Cancel</Button>\r\n          </Modal.Footer>\r\n        </Modal>\r\n      </>\r\n    );\r\n  }\r\n}\r\n\r\nexport default withToast(SigninNavItem);\r\n"],"sourceRoot":""}